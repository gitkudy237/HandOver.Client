@page "/announcements"

@rendermode InteractiveServer

@inject NavigationManager NavigationManager
@inject AnnouncementsClient AnnouncementsClient

<PageTitle>HandOver | Announcements</PageTitle>

<div class="main-content">
    <div class="main-content-header">
        <div class="header-container">
            
            <h2>Announcements</h2>
            <a href="/createannouncement">
                <button class="btn btn--primary">Create new</button>
            </a>

        </div>

    </div>
    @if (_announcements is null)
    {
        <p>Loading...</p>
    }
    else
    {
        if (_announcements.Length == 0)
        {
            <NoItemMessage 
                ActionText="No announcements yet."
                ButtonText="Create announcement"
                ActionLink="/createannouncements"/>
        }
        else
        {
            <div class="item-container">
                @foreach (var announcement in _announcements)
                {
                    <article class="card">
                        <div class="card-header">
                            <img src="@announcement.ImageUrl" alt="@announcement.Name" />
                        </div>
                        <div class="card-body flex">
                            <h3 class="card-title">
                                @announcement.Name
                            </h3>
                            <p class="price">
                                <span>@announcement.MinPrice.ToString("N0")</span> -
                                <span>@announcement.MaxPrice.ToString("N0")</span> FCFA
                            </p>
                            <div class="item-category">
                                <span>@(announcement.Category ?? string.Empty)</span>
                            </div>
                            <div class="details">
                                <p class="location">
                                    <i class="fa-solid fa-location-dot icon--primary"></i>
                                    <span>@announcement.Location</span>
                                </p>
                                <button class="btn btn--icon btn--primary" @onclick="() => ShowModal(announcement.Id)">
                                    <i class="fa-solid fa-info-circle"></i> Info
                                </button>
                                @* <p class="seller">
                    <i class="fa-solid fa-user-circle icon--warning"></i><span>@item.Seller</span>
                    </p> *@
                            </div>
                        </div>
                    </article>
                }
            </div>
            if (_target != 0){
                <AnnouncementModal @ref="_announcementModal" Id=@_target/>

            }
        }
    }
</div>

@code {
    private AnnouncementSummary[]? _announcements;
    private AnnouncementModal? _announcementModal;

    public int _target = 0;
    

    protected override async Task OnInitializedAsync()
    {
        _announcements = await AnnouncementsClient.GetAnnouncementsAsync();
    }

    private void ShowModal(int id)
    {
        _target = id;
        _announcementModal?.Show();
    }
}
